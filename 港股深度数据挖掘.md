
# 港股深度数据挖掘

[TOC]

## 流程

### 券商追踪

``` seq
start=>start
end=>end
op1=>operation: 取公司或交易席位

start->op1->end
```

## 表结构

### HK_BrokerTracking {#table.HK_BrokerTracking}

字段 | 说明
---- | ----
HKID |
InstitutionID | 公司ID
Symbol | 股票代码
AnnounceDate | 公布日期
TotalIssued | 总发行
CCASSParticipantID | 股票代码
NameofCCASSParticipant | 公司名称
Shareholding | 占股数
PercentofIssued | 占股百分比
Lang | 语言
CNameofCCASSParticipant | 简体公司名称
TNameofCCASSParticipant | 繁体公司名称
CreateTime | 创建时间
ModifyTime | 修改时间

### HK_BrokerTracking_Product

同[HK_BrokerTracking](#table.HK_BrokerTracking)

### Company

字段 | 说明
---- | ----
companyid       | 公司ID
ename           | 英文公司名
sname           | 简体公司名
tname           | 繁体公司名
allname     | 全称
shortname       | 简称
industry        | 所属行业
contact     | 联系方式
Tel             | 电话
Fax             | 传真
Email           | 邮箱
corporateRepresentative     | 法人代表
address                     | 地址
recordFrom                      |
relationid                      | 关联ID
cDate                           | 创建日期
mDate                           | 修改日期
del                             |

## ExchangerTrader

字段 | 说明
---- | ----
exchangertraderid           | 交易所id
companyid                   | 公司id
exchangerID                 |
ExchangerTraderNo           | 参与者编号（结算席位号）

## SecuritiesTraderDailyHoldStock

字段 | 说明
---- | ----
exchangertraderid            | id
stockcode                    | 股票代码
holdstockamount          | 持股数
issuerPer                    | 发行占比
issuerTotalshares       |
publishdate              | 公布日期
cDate                        | 创建日期
mDate                        | 修改日期
del     |
dayQty                       | 日持股数
dayPer                       | 日持股比
weekQty                      | 周持股数
weekPer                      | 周持股比
monthQty                     | 月持股数
monthPer                     | 月持股比

## tbEconomy

字段 | 说明
---- | ----
NoCode                |
EndNoCode   |
Name_English       | 公司名称（英文）
Name_TC            | 公司名称
ShortName_TC       | 公司简称
RecordDate         | 记录日期
EditDate               | 编辑日期
Remark             |
id                     | id
companyid              | 公司id
status             | 状态

## TraderStockcodeLists

字段 | 说明
---- | ----
exchangertraderid     | 交易所id
stockcode                  | 股票代码
TraderShortName            | 公司简称

## stockholder

字段 | 说明
---- | ----
stockholderid |
companystuffsid |
stockcode |
capacity |
status |

## stockholderRecords

字段 | 说明
---- | ----
stockholderid |
changedate |
changeQtyS |
changeQtyL |
changeQtyP |
AvgPrice |
holdQtyS |
holdQtyL |
holdQtyP |
IssuerPerS |
IssuerPerL |
IssuerPerP |
changeEvetCode |
Publishdate |
classofshares |
currencyType |
issuerTotalQty |

## statSharesHolderStock

字段 | 说明
---- | ----
ename | 英文名称
tname | 繁体中文名称
sname | 简体中文名称
stockcode | 证券代码
capacity | 0-所有权益披露者<br>1-个人大股东<br>2-法团大股东<br>3-董事／最高行政人员<br>4-董事／行政人员投资于法团相联公司<br>-1-未知
changeDate | 有关事件的日期
changeEventCode | 做出披露的原因
classofshares | 股份类别
AvgPrice | 均价
changeQtyL | 好仓变化数量
holdQtyL | 好仓持仓数量
issuerPerL | 好仓持仓占比
changePerL |
changeQtyS |
holdQtyS |
issuerPerS |
changePerS |
changeQtyP |
holdQtyP |
issuerPerP |
changePerP |

## 输出

### xml

券商追踪栏目由xml输出，输出的目录结构如下：

```
other
    --- afterlastfiveholdstock.xml
stockcode
    --- E0001.xml
    --- E0002.xml
    --- ...
stockcode_trader
    +++ E0001
        --- E00001_巴西证券有限公司.xml
        --- E00001_JPMORGAN CHASE BANK, NATIONAL ASSOCIATION.xml
        --- ...
    +++ E0002
        --- E00002_ABN AMRO CLEARING HONG KONG LTD.xml
        --- E00002_包大卫证券投资有限公司.xml
        --- ...
    +++ ...
trader
    --- 安鑫天玛.xml
    --- SMBC.xml
    --- ...
```

#### stock

- 命名规则：证券代码
- 保存持有该证券的最新券商列表

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<body>
    <row>
        <pd>20140403</pd><!-- 数据日期 -->
        <sn>永隆证券</sn><!-- 券商名称 -->
        <hs>3715328</hs><!-- 券商持股数量 降序排序 -->
        <ip>0.160</ip><!-- 券商持股比例 -->
        <dq>-56000</dq><!-- 日变化数量 -->
        <dp>0.000</dp><!-- 日变化比例 -->
        <wq>-52000</wq><!-- 周变化数量 -->
        <wp>0.000</wp><!-- 周变化比例 -->
        <mq>-126210</mq><!-- 月变化数量 -->
        <mp>0.000</mp><!-- 月变化比例 -->
    </row>
    ...
</body>
```

#### trader

- 命名规则：券商名称
- 保存该券商最新持有的证券列表

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<body>
    <row>
        <pd>20140403</pd>
        <sc>E00003</sc><!-- 证券代码 -->
        <hs>520000</hs><!-- 降序排序 -->
        <ip>0.000</ip>
        <dq>0</dq>
        <dp>0.000</dp>
        <wq>0</wq>
        <wp>0.000</wp>
        <mq>0</mq>
        <mp>0.000</mp>
    </row>
    ...
</body>
```

#### stockcode_trader

- 按照证券代码建立目录
- 每个子目录下面的文件命名规则：证券代码_券商名称
- 保存该券商持有该证券的历史记录

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<body>
    <row>
        <pd>20160229</pd><!-- 降序排序 -->
        <hs>39552</hs>
        <ip>0.000</ip>
        <dq>0</dq>
        <dp>0.000</dp>
        <wq>0</wq>
        <wp>0.000</wp>
        <mq>-2000</mq>
        <mp>0.000</mp>
    </row>
    ...
</body>
```

#### other

- 仅保存一个文件
- 该文件保存最近5天以内，日变化率>=2% 或 周变化率>=4% 或 月变化率>=10% 的全部记录
- **不得超过500条记录**，超过后需要删除日期距现在久远的，证券代码更大的记录

``` xml
<?xml version="1.0" encoding="UTF-8"?>
<body>
    <row>
        <st>中银国际</st><!-- 券商名称 -->
        <sc>E00001</sc><!-- 升序排序 -->
        <pd>20151014</pd><!-- 降序排序 -->
        <hs>10944056</hs>
        <ip>0.280</ip>
        <dq>597444</dq>
        <dp>0.020</dp>
        <wq>426816</wq>
        <wp>0.010</wp>
        <mq>514850</mq>
        <mp>0.010</mp>
    </row>
    ...
</body>
```
